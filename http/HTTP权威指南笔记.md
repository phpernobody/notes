<<<<<<< HEAD:web/HTTP权威指南笔记.md
#第一部分 HTTP:Web的基础

##第一章 HTTP概述

####HTTP概念
>超文本传输协议（HTTP，HyperText Transfer Protocol)是互联网上应用最为广泛的一种网络协议，从技术架构上来讲HTTP是一个客户端和服务器端请求和应答的标准；

####资源
资源是一个很重要的概念，网络中所有的内容（包括文本、音频、应用、脚本等）都可以称之为一个资源，所有的资源存储在web服务器中，web客户端通过http请求web服务器中的资源，然后展示在浏览器上。关于资源有以下几个内容：
######媒体类型
资源的类型，因特网上有数千种不同的数据类型，http给每种数据对象定义了一个名为MIME类型的数据格式标签，通过该标签可以很清晰地知道数据的类型。
######URI
URI称为统一资源标识符，每个资源都有一个标识，客户端可以通过这个名字找到该资源在因特网中的位置。
######URL
URL称为统一资源定位符，描述了每个资源的位置，是URI的一种，现在基本把URI和URL当做同一个东西。
######URN
URN称为统一资源名，作为特定内容唯一使用的名字，与资源所在地址无关，目前尚处于试验阶段。

**个人理解**
URL通过资源的地址和文件名来获取该资源，URN的通过资源的名字来获取同一个资源，URN的设计意义在于防止资源被移走的时候就访问不到资源。

####事务
一个http事务由请求命令(客户端发起)和一个响应结果(服务端返回)组成，HTTP支持多种不同的请求方式，常用的有以下5中：
- GET		服务端向客户端发送命名资源
- PUT		将来自客户端的数据存储到一个命名的服务器资源中去
- DELETE	从服务器中删除命名资源
- POST		将客户端数据发送到一个服务器网关应用程序
- HEAD		仅发送命名资源响应中的HTTP首部

####报文
>HTTP事务处理的载体是报文，服务端通过请求报文来处理请求，同时返回响应报文给客户端。

HTTP报文包括：起始行、首部字段和主体三大部分。


####连接
>HTTP报文构成之后，通过TCP/IP协议发送报文，接收方再通过TCP/IP接收后进行处理。

基本的浏览器连接处理包括：
1. 用户输入URL
2. 客户端经过DNS解析后获取到服务端IP地址
3. 客户端根据IP地址向服务端发送一个HTTP请求
4. 服务端向客户端返回HTTP响应
5. 关闭连接


####协议版本
- HTTP/0.9：有严重的设计缺陷，很快被HTTP/1.0替代。
- HTTP/1.0：第一个广泛使用的HTTP版本。
- HTTP/1.0+：非正式的HTTP扩展版本。
- HTTP/1.1：当前使用的HTTP版本，支持更复杂的web应用程序和部署方式。
- HTTP-NG(HTTP/2.0)：之后的版本。

####Web的结构组件
- 代理：位于客户端和服务器之间的HTTP中间实体。
- 缓存：HTTP的仓库，将资源副本保存在离客户端更近的地方。
- 网关：连接其他应用程序的特殊Web服务器。
- 隧道：对HTTP通信报文进行盲转发的特殊代理。
- Agent代理：发起自动HTTP请求的半智能Web客户端。


##第二章 URL与资源
####URL语法
	<scheme>://<user>:<password>@<host>:<port>/<path>;<params>?<query>#<frag>
- 方案：访问服务器时使用的协议
- 用户：某些方案访问资源需要用户名
- 密码：某些方案访问需要密码
- 主机：资源宿主服务器的主机名或分点IP
- 端口：资源服务器正在监听的端口（很多默认端口80）
- 路径：服务器上资源本的本地名
- 参数：某些方案会用这个组件来指定输入参数，参数为键=值的方式传入
- 查询：某些方案会用这个组件来传递参数以激活应用
- 片段：一小片或一部分资源的名字

####相对URL
>URL有绝对的和相对的，相对URL为相对当前资源所在路径。

####各种字符
>URL追求安全性、可读性和完整性，为了安全传输，URL只能使用一些相对较小的、通用的安全字母表中的字符，为了可读性，一些不可见、不可打印的字符也不能在URL中使用，最后为了完整性，需要一种转义机制。

######编码机制
为了避开安全字符集表示法带来的限制，人们设计了一种编码机制，用来在URL中表示各种不安全的字符，这种机制就是通过转义来表示不安全字符，这种表示法就是%后面跟上表示ASCII码的十六进制数，例如字符~的ASCII码为37(0x25)，在URL中用%25来代表~。

######字符限制
在URL中，有几个字符被保留起来，有着特殊的含义，例如%/.#？；：$,+@&={}|\~^[]'<>"等等。

<table>
<tr><td>方案</td><td>描述</td><td>基本格式</td></tr>
<tr><td>http</td><td>超文本传输协议方案，除了没有用户名和密码之外，与通用的URL格式相符。如果省略了端口，就默认为80。</td><td>http://host:port/path/query#frag</td></tr>
<tr><td>https</td><td>方案https与方案http是一对。唯一的区别在于方案https使用了网景的SSL，SSL为HTTP连接提供了端到端的加密机制。其语法与http的语法相同，默认端口为443。</td><td>https://host:port/psth?query#frag</td></tr>
<tr><td>mailto</td><td>Mailto URL指向的是E-mail地址。由于E-mail的行为与其他方案都有不同（它并不能指向任何可以直接访问的对象），所以mailto URL的格式与标准URL的格式也有所不同。</td><td>mailto:user@host</td></tr>
<tr><td>ftp</td><td>文本传输协议URL可以用来从FTP服务器上下载或向其上传文件，并获取FTP服务器上的目录结构内容的列表。在WEB和URL出现之前ftp就已经存在了。web应用程序将ftp作为一种数据访问方案使用。</td><td>ftp://user:password@host:port/path;params</td></tr>
<tr><td>rtsp,rtspu</td><td>RTSP URL是可以通过实时流传输协议（real time streaming protocol）解析的音/视屏媒体资源的标识符。方案RTSPU中的u表示使用的是UDP协议来获取资源的。</td><td>rtsp://user:password@host:port/path</td></tr>
<tr><td>file</td><td>方案file表示一台指定主机上可直接访问的文件。各个字段都遵循通用格式。如果省略了主机名，就默认为正在使用的URL的本地主机。</td><td>file://host/path</td></tr>
<tr><td>news</td><td>方案news用来访问一些特定的文章或新闻组。它有一个很独特的性质：news URL自身包含的信息不足以对资源进行定位。news URL中缺乏到何处获取资源的信息--没有提供主机名或机器名称。从用户那里获取此类信息是解释程序的工作。比如，在网景浏览器的“选项”菜单中，就可以指定自己的NNTP（news）服务器。这样，浏览器有了news URL的时候就知道应该使用哪个服务器了。</td><td>news:newsgrounp</td></tr>
<tr><td>telnet</td><td>方案telnet用于访问交互式业务。它表示的并不是对象本身，而是通过telnet协议访问的交互式应用程序(资源)</td><td>telnet://user:password@host:port</td></tr>
</table>


##第四章	连接管理
####TCP连接
>几乎所有的HTTP通信都是由TCP/IP承载的，TCP/IP是全球计算机及网络设备都在使用的一种常用的分组交换网络分层协议集。

######TCP为HTTP提供了一条可靠的比特传输管道，从TCP连接一端填入的字节会从另一端以原有的顺序正确地传送出来。

######TCP数据流
>TCP的数据是通过名为IP分组(IP数据报)的小数据块来发送的。
每个IP分组包括：

- IP分组首部
- TCP段首部
- TCP数据块

IP首部包含了源/目的IP地址和其他标记，TCP首部包含了TCP数据块的相关信息，TCP数据块承载着数据信息。

######TCP连接时刻都有几条连接处于打开状态
>TCP通过首部的源/目的IP地址和源/目的端口号来定义一条连线。

######TCP套接字编程
>操作系统提供了一些操纵TCP连接的工具，几乎所有系统都有其变体存在，以下是常见的套接字接口函数：
<table>
<tr><td>套接字API调用</td><td>描述</td></tr>
<tr><td>s=socket([parameters])</td><td>创建一个新的、未命名、未关联的套接字</td></tr>
<tr><td>bind(s,[local IP:host])</td><td>向套接字赋一个本地端口号和接口</td></tr>
<tr><td>connect(s,[remote IP:port])</td><td>创建一条连接本地套接字与远程主机及端口的连接</td></tr>
<tr><td>listen(s,...)</td><td>标识一个本地套接字，使其可以合法接受连接</td></tr>
<tr><td>s2=accept(s)</td><td>等待某人建立一条到本地端口的连接</td></tr>
<tr><td>n=read(s,buffer,n)</td><td>尝试从套接字向缓存区读取n个字符</td></tr>
<tr><td>n=write(s,buffer,n)</td><td>尝试从缓冲区中向套接字写入n个字符</td></tr>
<tr><td>close(s)</td><td>完全关闭TCP连接</td></tr>
<tr><td>shutdown(s,[side])</td><td>只关闭TCP连接的输入或输出器</td></tr>
<tr><td>getsockopt(s,...)</td><td>读取某个内部套接字配置选项的值</td></tr>
<tr><td>setsockopt(s,...)</td><td>修改某个内部套接字配置选项的值</td></tr>
</table>

######TCP性能
>HTTP事务的性能很大程度上取决于底层TCP通道的性能，了解TCP的性能有助于设计实现一些更高性能的HTTP应用程序。

1. HTTP事务的时延主要有以下埃及汇总主要原因：
	- 客户端没有缓存待访问URI的IP地址和端口号，需要通过DNS解析系统将主机名转换成一个IP地址；
	- 客户端向服务器发送TCP连接请求，并等待服务器回送一个请求接收应答，这就是TCP连接的连接建立时延；
	- 连接建立起来后，客户端向服务器发送请求报文，服务器处理请求报文也需要时间；
	- 最后服务器回送HTTP响应也需要时间。
2. 性能聚焦区域
	>以下列出了一些对HTPP程序员产生影响的常见TCP相关时延：
	- TCP连接握手
		
		建立一条新的TCP连接甚至发送任意数据之前，TCP软件之间会进行握手动作来保证传输的可靠性，对于小数据来说，在处理连接握手所占的时间比例太大，应该尽量避免

	- 延时确认
		
		为了保证数据成功传输，每个TCP段都有一个序列号和数据完整性校验和，每个段的接收者在收到完整的段时都会回送小的确认分组，如果发送者在指定时间内未收到确认分组就认为数据被破坏并重发数据。

		由于确认分组很小，为了有效利用网络，TCP允许在发往相同方向的数据分组中对其进行“捎带”。为了增加确认报文找到同向传输数据分组的可能，很多TCP栈实现了一种“延时确认”的算法，延时确认算法会在一个特定的时间(通常100~200ms)内将确认分组放在缓冲区中，如果时间内没找到输出分组则单独传送。延时算法会引入相当大的时延。

	- TCP慢启动
	
		为了防止因特网的突然过载和拥塞，TCP连接刚开始会限制传输速度，在每次分组成功发送出去后会逐渐放开限制(书上的介绍貌似是翻倍放开的，比如第一次可以发送一个分组，第二次可以发送两个分组，第三次可以发送四个分组，最后限制在一个最大限制分组数)，这种方式被称为“打开拥塞窗口”。

	- Nagle算法
		
		由于TCP握手时延，所以发送小数据块是一种很大的浪费，为了优化发明了Nagle算法，该算法会在集齐足够大的数据块后发送。该算法会带来几种性能问题，具体网上深究！

	- TIME_WAIT累积和端口耗尽
		
		当TCP端点关闭连接时，会在内存中维护一个小的控制块来记录最近关闭连接的IP地址和端口号，控制块存活的时间一般是使用期的两倍时间。由于一个TCP连接分组由源/目的IP地址和源/目的端口号，在性能测试中，前三者都确定了，为了只有源端口号可以随意改变，所以短时间内有可能产生端口耗尽的问题(端口不够用)。
		
######HTTP连接的处理
=======
#第一部分 HTTP:Web的基础

##第一章 HTTP概述

####HTTP概念
>超文本传输协议（HTTP，HyperText Transfer Protocol)是互联网上应用最为广泛的一种网络协议，从技术架构上来讲HTTP是一个客户端和服务器端请求和应答的标准；

####资源
资源是一个很重要的概念，网络中所有的内容（包括文本、音频、应用、脚本等）都可以称之为一个资源，所有的资源存储在web服务器中，web客户端通过http请求web服务器中的资源，然后展示在浏览器上。关于资源有以下几个内容：
######媒体类型
资源的类型，因特网上有数千种不同的数据类型，http给每种数据对象定义了一个名为MIME类型的数据格式标签，通过该标签可以很清晰地知道数据的类型。
######URI
URI称为统一资源标识符，每个资源都有一个标识，客户端可以通过这个名字找到该资源在因特网中的位置。
######URL
URL称为统一资源定位符，描述了每个资源的位置，是URI的一种，现在基本把URI和URL当做同一个东西。
######URN
URN称为统一资源名，作为特定内容唯一使用的名字，与资源所在地址无关，目前尚处于试验阶段。

**个人理解**
URL通过资源的地址和文件名来获取该资源，URN的通过资源的名字来获取同一个资源，URN的设计意义在于防止资源被移走的时候就访问不到资源。

####事务
一个http事务由请求命令(客户端发起)和一个响应结果(服务端返回)组成，HTTP支持多种不同的请求方式，常用的有以下5中：
- GET		服务端向客户端发送命名资源
- PUT		将来自客户端的数据存储到一个命名的服务器资源中去
- DELETE	从服务器中删除命名资源
- POST		将客户端数据发送到一个服务器网关应用程序
- HEAD		仅发送命名资源响应中的HTTP首部

####报文
>HTTP事务处理的载体是报文，服务端通过请求报文来处理请求，同时返回响应报文给客户端。

HTTP报文包括：起始行、首部字段和主体三大部分。


####连接
>HTTP报文构成之后，通过TCP/IP协议发送报文，接收方再通过TCP/IP接收后进行处理。

基本的浏览器连接处理包括：
1. 用户输入URL
2. 客户端经过DNS解析后获取到服务端IP地址
3. 客户端根据IP地址向服务端发送一个HTTP请求
4. 服务端向客户端返回HTTP响应
5. 关闭连接


####协议版本
- HTTP/0.9：有严重的设计缺陷，很快被HTTP/1.0替代。
- HTTP/1.0：第一个广泛使用的HTTP版本。
- HTTP/1.0+：非正式的HTTP扩展版本。
- HTTP/1.1：当前使用的HTTP版本，支持更复杂的web应用程序和部署方式。
- HTTP-NG(HTTP/2.0)：之后的版本。

####Web的结构组件
- 代理：位于客户端和服务器之间的HTTP中间实体。
- 缓存：HTTP的仓库，将资源副本保存在离客户端更近的地方。
- 网关：连接其他应用程序的特殊Web服务器。
- 隧道：对HTTP通信报文进行盲转发的特殊代理。
- Agent代理：发起自动HTTP请求的半智能Web客户端。


##第二章 URL与资源
####URL语法
	<scheme>://<user>:<password>@<host>:<port>/<path>;<params>?<query>#<frag>
- 方案：访问服务器时使用的协议
- 用户：某些方案访问资源需要用户名
- 密码：某些方案访问需要密码
- 主机：资源宿主服务器的主机名或分点IP
- 端口：资源服务器正在监听的端口（很多默认端口80）
- 路径：服务器上资源本的本地名
- 参数：某些方案会用这个组件来指定输入参数，参数为键=值的方式传入
- 查询：某些方案会用这个组件来传递参数以激活应用
- 片段：一小片或一部分资源的名字

####相对URL
>URL有绝对的和相对的，相对URL为相对当前资源所在路径。

####各种字符
>URL追求安全性、可读性和完整性，为了安全传输，URL只能使用一些相对较小的、通用的安全字母表中的字符，为了可读性，一些不可见、不可打印的字符也不能在URL中使用，最后为了完整性，需要一种转义机制。

######编码机制
为了避开安全字符集表示法带来的限制，人们设计了一种编码机制，用来在URL中表示各种不安全的字符，这种机制就是通过转义来表示不安全字符，这种表示法就是%后面跟上表示ASCII码的十六进制数，例如字符~的ASCII码为37(0x25)，在URL中用%25来代表~。

######字符限制
在URL中，有几个字符被保留起来，有着特殊的含义，例如%/.#？；：$,+@&={}|\~^[]'<>"等等。

<table>
<tr><td>方案</td><td>描述</td><td>基本格式</td></tr>
<tr><td>http</td><td>超文本传输协议方案，除了没有用户名和密码之外，与通用的URL格式相符。如果省略了端口，就默认为80。</td><td>http://host:port/path/query#frag</td></tr>
<tr><td>https</td><td>方案https与方案http是一对。唯一的区别在于方案https使用了网景的SSL，SSL为HTTP连接提供了端到端的加密机制。其语法与http的语法相同，默认端口为443。</td><td>https://host:port/psth?query#frag</td></tr>
<tr><td>mailto</td><td>Mailto URL指向的是E-mail地址。由于E-mail的行为与其他方案都有不同（它并不能指向任何可以直接访问的对象），所以mailto URL的格式与标准URL的格式也有所不同。</td><td>mailto:user@host</td></tr>
<tr><td>ftp</td><td>文本传输协议URL可以用来从FTP服务器上下载或向其上传文件，并获取FTP服务器上的目录结构内容的列表。在WEB和URL出现之前ftp就已经存在了。web应用程序将ftp作为一种数据访问方案使用。</td><td>ftp://user:password@host:port/path;params</td></tr>
<tr><td>rtsp,rtspu</td><td>RTSP URL是可以通过实时流传输协议（real time streaming protocol）解析的音/视屏媒体资源的标识符。方案RTSPU中的u表示使用的是UDP协议来获取资源的。</td><td>rtsp://user:password@host:port/path</td></tr>
<tr><td>file</td><td>方案file表示一台指定主机上可直接访问的文件。各个字段都遵循通用格式。如果省略了主机名，就默认为正在使用的URL的本地主机。</td><td>file://host/path</td></tr>
<tr><td>news</td><td>方案news用来访问一些特定的文章或新闻组。它有一个很独特的性质：news URL自身包含的信息不足以对资源进行定位。news URL中缺乏到何处获取资源的信息--没有提供主机名或机器名称。从用户那里获取此类信息是解释程序的工作。比如，在网景浏览器的“选项”菜单中，就可以指定自己的NNTP（news）服务器。这样，浏览器有了news URL的时候就知道应该使用哪个服务器了。</td><td>news:newsgrounp</td></tr>
<tr><td>telnet</td><td>方案telnet用于访问交互式业务。它表示的并不是对象本身，而是通过telnet协议访问的交互式应用程序(资源)</td><td>telnet://user:password@host:port</td></tr>
</table>
>>>>>>> 63d835c6f7b4529eb07e13f5943c1cca5b93c0f7:web/http/HTTP权威指南笔记.md
