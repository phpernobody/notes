##微信重要参数概念
- access_token：
	- access_token是公众号的全局唯一票据，公众号调用各接口时都需使用access_token。access_token的有效期目前为2个小时，需定时刷新，重复获取将导致上次获取的access_token失效。
	- **access_token分为网页授权access_token和普通access_tonken,前者用于网页授权后的接口调用，后者用于其它微信接口的调用**。
- openid：
	- 用户唯一标识。
- APPID：
	- appid是微信公众账号或开放平台APP的唯一标识，在公众平台申请公众账号或者在开放平台申请APP账号后，微信会自动分配对应的appid，用于标识该应用。可在微信公众平台-->开发者中心查看，商户的微信支付审核通过邮件中也会包含该字段值。
- Appsecret：
	- AppSecret是APPID对应的接口密码，用于获取接口调用凭证access_token时使用。在微信支付中，先通过OAuth2.0接口获取用户openid，此openid用于微信内网页支付模式下单接口使用。在开发模式中获取AppSecret（成为开发者且帐号没有异常状态）。
- UnionID
	- 如果开发者拥有多个移动应用、网站应用和公众帐号，可通过获取用户基本信息中的unionid来区分用户的唯一性，因为同一用户，对同一个微信开放平台下的不同应用（移动应用、网站应用和公众帐号），unionid是相同的






##支付方式
>微信支付分为四种：

1. 刷卡支付（商家扫用户）
	- 刷卡支付是用户展示微信钱包内的“刷卡条码/二维码”给商户系统扫描后直接完成支付的模式。主要应用线下面对面收银的场景。
2. 扫码支付（用户扫商家）
	- 扫码支付是商户系统按微信支付协议生成支付二维码，用户再用微信“扫一扫”完成支付的模式。该模式适用于PC网站支付、实体店单品或订单支付、媒体广告支付等场景。
3. 公众号支付（h5调用jsapi接口）
	
	>公众号支付是用户在微信中打开商户的H5页面，商户在H5页面通过调用微信支付提供的JSAPI接口调起微信支付模块完成支付。应用场景有：
		
	- 用户在微信公众账号内进入商家公众号，打开某个主页面，完成支付
	- 用户的好友在朋友圈、聊天窗口等分享商家页面连接，用户点击链接打开商家页面，完成支付
	- 将商户页面转换成二维码，用户扫描二维码后在微信浏览器中打开页面后完成支付
4. APP支付
	- APP支付又称移动端支付，是商户通过在移动端应用APP中集成开放SDK调起微信支付模块完成支付的模式。

####公众号支付
- [官方文档](https://pay.weixin.qq.com/wiki/doc/api/jsapi.php)

- 支付时序图

	![](https://pay.weixin.qq.com/wiki/doc/api//img/chapter7_4_1.png)

- 步骤
	1. 设置测试目录
		- 微信公众平台->微信支付->开发配置->测试授权目录，设置支付测试目录；
		- 微信公众平台->微信支付->开发配置->测试白名单，设置测试微信号；
		- 注意：
			- 不能与正式支付目录设为一样；
			- 测试目录可以是IP地址；
	2. 设置正式支付目录
		- 微信公众平台->微信支付->开发配置->支付授权目录，设置支付目录；
		- 注意:
			- 所有使用公众号支付方式发起支付请求的链接地址，都必须在支付授权目录之下
			- 最多设置3个支付授权目录，且域名必须通过ICP备案
			- 头部要包含http或https，须细化到二级或三级目录，以左斜杠“/”结尾
	3. 商户前端调用后端接口
	4. 商户后端接口处理
		- 生成商户订单
		- 调用微信支付系统的下单api，生成预付单
		- 生成支付参数并签名
		- 返回签名参数给商户前端
	5. 商户前端调用jsapi，并完成支付
	6. 商户前端根据回调处理交互
	7. 商户后端根据支付结果推送处理商户订单的状态
	>注意：6和7这两个步骤是异步触发的，没有先后关系。






##微信授权认证

####微信网页授权
- 网页授权两种scope：
	- 以snsapi_base为scope发起的网页授权，是用来获取进入页面的用户的openid的，并且是静默授权并自动跳转到回调页的。
	- 以snsapi_userinfo为scope发起的网页授权，是用来获取用户的基本信息的。但这种授权需要用户手动同意，并且由于用户同意过，所以无须关注，就可在授权后获取该用户的基本信息。
	- 用户管理类接口中的“获取用户基本信息接口”，是在用户和公众号产生消息交互或关注后事件推送后，才能根据用户OpenID来获取用户基本信息。这个接口，包括其他微信接口，都是需要该用户（即openid）关注了公众号后，才能调用成功的。
- 网页授权access_token和普通access_token的区别
	- 微信网页授权是通过OAuth2.0机制实现的，在用户授权给公众号后，公众号可以获取到一个网页授权特有的接口调用凭证（网页授权access_token），通过网页授权access_token可以进行授权后接口调用，如获取用户基本信息；
	- 其他微信接口，需要通过基础支持中的“获取access_token”接口来获取到的普通access_token调用。
- 步骤
	1. 公众平台->公众号设置->功能设置->网页授权域名->设置回调地址，注意：
		- 不需要加"http://"等协议头
		- 配置为全域名
	2. 用户同意授权，获取code
	3. 通过code获取网页授权access_token
	4. 刷新access_token(如果有需要)
	5. 拉取用户信息（要求非静默授权）
	6. 检验授权凭证（access_token ）是否有效



####